# Azure Web App + MySQL Database Setup Commands

# 1. SSH into your Azure App Service Console and run these commands:

# Navigate to the correct directory
cd /home/site/wwwroot

# Set permissions
chmod -R 755 storage bootstrap/cache
chmod -R 777 storage
chmod 644 storage/DigiCertGlobalRootCA.crt.pem

# Create storage directories
mkdir -p storage/app/public
mkdir -p storage/framework/cache  
mkdir -p storage/framework/sessions
mkdir -p storage/framework/views
mkdir -p storage/logs

# Clear caches
php artisan config:clear
php artisan cache:clear
php artisan route:clear
php artisan view:clear

# Copy environment file if needed
cp .env.example .env

# Generate application key
php artisan key:generate --force

# Create storage symlink
php artisan storage:link

# Test database connection
php artisan tinker --execute="echo 'DB Host: ' . config('database.connections.mysql.host'); echo 'DB Name: ' . config('database.connections.mysql.database'); DB::connection()->getPdo();"

# Cache for production
php artisan config:cache
php artisan route:cache  
php artisan view:cache

# Run migrations and seeders
php artisan migrate --force
php artisan db:seed --force

# Verify setup
php artisan route:list
curl https://your-app-name.azurewebsites.net/test

# 2. Azure Portal Configuration:

# Application Settings (Environment Variables):
APP_NAME="Tourism App"
APP_ENV=production
APP_DEBUG=false  
APP_URL=https://your-app-name.azurewebsites.net
DB_CONNECTION=mysql
DB_HOST=your-mysql-server.mysql.database.azure.com
DB_PORT=3306
DB_DATABASE=tourism_app
DB_USERNAME=your-mysql-username@your-mysql-server
DB_PASSWORD=your-mysql-password
MYSQL_ATTR_SSL_CA=/home/site/wwwroot/storage/DigiCertGlobalRootCA.crt.pem
SESSION_DRIVER=database
CACHE_STORE=database
QUEUE_CONNECTION=database
LOG_LEVEL=error

# 3. Azure MySQL Database Setup:
# - Create Azure Database for MySQL server
# - Create database named 'tourism_app'
# - Configure firewall to allow Azure services
# - Enable SSL enforcement (recommended)
# - Create a user with proper permissions

# 4. Connection String Format:
# mysql://username:password@hostname:port/database?sslmode=require
